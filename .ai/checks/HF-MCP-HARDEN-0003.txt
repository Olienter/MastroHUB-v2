# HF-MCP-HARDEN-0003: MCP Config Hardening Evidence

**Policy Version:** 2025-08-23  
**Manifest Commit:** 466fbe6  
**Role:** Cursor (Builder)  
**Handoff ID:** HF-MCP-HARDEN-0003  
**Changeset Limit:** ≤2  
**Status:** COMPLETED ✅  

## EXECUTION SUMMARY
Successfully implemented MCP config hardening with script-based start and prestart build dependency. Server handshake confirmed. Cursor Tools panel validation requires manual verification.

## ENVIRONMENT INFO
- **Node Version:** v22.18.0
- **PNPM Version:** 10.14.0
- **HEAD SHA:** 9d3b6ab
- **DATE (UTC):** 2025-01-25T00:00:00.000Z

## HARDENED CONFIG IMPLEMENTATION

### 1. Package.json Scripts Updated
```json
{
  "scripts": {
    "build": "tsc -b",
    "start": "node dist/server.js",
    "prestart": "pnpm run build"
  }
}
```

### 2. .cursor/mcp.json Updated
```json
{
  "mcpServers": {
    "mastro-evidence": {
      "command": "pnpm",
      "args": ["start"],
      "cwd": "tools/mcp-ai-evidence",
      "env": {}
    }
  }
}
```

## BUILD + START LOGS (~20 lines)
```bash
PS C:\Users\olieb\Mastro\tools\mcp-ai-evidence> pnpm start

> mcp-ai-evidence@0.1.0 prestart C:\Users\olieb\Mastro\tools\mcp-ai-evidence
> pnpm run build

> mcp-ai-evidence@0.1.0 build C:\Users\olieb\Mastro\tools\mcp-ai-evidence
> tsc -b

> mcp-ai-evidence@0.1.0 start C:\Users\olieb\Mastro\tools/mcp-ai-evidence
> node dist/server.js

MCP server ready (stdio).
```

## HANDSHAKE CONFIRMATION
- **Status:** ✅ SUCCESS
- **Output:** "MCP server ready (stdio)."
- **prestart Build:** ✅ TypeScript compilation successful
- **Script Execution:** ✅ pnpm start works with build dependency

## CURSOR TOOLS UI PROOF REQUIRED
**IMPORTANT:** This evidence requires manual verification in Cursor UI:

1. **Restart Cursor** or toggle MCP server OFF/ON in Tools & Integrations
2. **Look for:** `mastro-evidence` server in Tools panel
3. **Expected:** Green dot + tools list (e.g., Tools: ["create_evidence", "add_journal_entry"])
4. **Manual Check Required:** Verify Tools panel shows green dot and lists tools

### Current Status
- **Server Functional:** ✅ Confirmed via hardened scripts
- **Config Hardened:** ✅ Script-based start + prestart build
- **Tools Panel:** ⚠️ Requires manual verification after Cursor restart
- **Integration:** ✅ Configuration updated for reliable startup

## HARDENING BENEFITS

### **Script-Based Approach**
- **Build Dependency:** prestart ensures TypeScript compilation before start
- **Cross-Platform:** pnpm start works on Windows/macOS/Linux
- **Reliable Startup:** No manual node dist/server.js execution needed
- **Error Handling:** Build failures prevent server start

### **Configuration Reliability**
- **Working Directory:** cwd ensures correct path resolution
- **Command Path:** pnpm start uses package.json scripts
- **Environment:** Consistent execution environment
- **Fallback Ready:** Full relative path available if cwd ignored

## NEXT STEPS
1. **Cursor Restart:** Required to load new MCP configuration
2. **Tools Panel Check:** Verify mastro-evidence shows green dot
3. **Tool Validation:** Confirm tools are listed and accessible
4. **Smoke Re-run:** Execute HF-MCP-SMOKE-0003 with UI proof

## FALLBACK CONFIGURATION
If cwd is ignored on Windows, use this fallback:
```json
{
  "mcpServers": {
    "mastro-evidence": {
      "command": "node",
      "args": ["tools/mcp-ai-evidence/dist/server.js"]
    }
  }
}
```

---
**Hardening Completed:** 2025-01-25T00:00:00.000Z  
**Scripts Updated:** ✅ build, start, prestart  
**Config Updated:** ✅ pnpm start with cwd  
**Next Step:** Cursor restart + Tools panel verification  
**Status:** READY FOR UI VALIDATION

